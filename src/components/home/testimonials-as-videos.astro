---
const slides = [
    { image: "/thumbnail/thumbnail-1.webp" },
    { image: "/thumbnail/thumbnail-2.webp" },
    { image: "/thumbnail/thumbnail-3.webp" },
];
---

<section id="testimonials-as-videos" class="videos section">
    <!-- Section Title -->
    <div class="container section-title">
        <h2>Avis</h2>
        <div>
            <span>Ils témoignent</span>
            <span class="description-title">de notre impact</span>
        </div>
    </div>
    <!-- End Section Title -->

    <div class="container">
        <div class="row align-items-center gy-4">
            <!-- Swiper -->
            <div class="col-lg-3">
                <div class="swiper video-swiper position-relative">
                    <div class="swiper-wrapper">
                        {
                            slides.map((slide,key) => (
                                <div class="swiper-slide overflow-hidden">
                                     <div class="video-wrapper position-relative"> 
                                        <img
                                        width="100%" height="100%"
                                            src={slide.image}
                                            class="img-fluid"
                                            alt={`thumbnail-${key} - Brosmedia`}
  loading="lazy"

                                        />
                                        <div class="play-icon" />
                                     </div> 
                                </div>
                            ))
                        }
                    </div>

                    <!-- Navigation buttons -->
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                </div>
            </div>

            <!-- Text -->
            <div class="col-lg-9">
                <div class="videos-section-content">
                    <h2>L'impact de Brosmedia</h2>
                    <p class="lead">
                        Chez Brosmedia, chaque projet est une histoire de
                        transformation. Grâce à notre approche personnalisée et
                        humaine, nous aidons nos clients à franchir un cap dans
                        leur présence digitale. Que ce soit par la création de
                        sites web percutants, des campagnes marketing efficaces
                        ou des vidéos publicitaires engageantes, nous
                        contribuons concrètement à leur croissance.
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const slides = [
            { url: "https://www.videoask.com/f02f0r1ef" },
            { url: "https://www.videoask.com/fujo8ptxi" },
            { url: "https://www.videoask.com/fcstso7o3" },
        ];
    
        // Initialize originalContents first
        const originalContents = [];
        
        const swiper = new Swiper(".video-swiper", {
            loop: true,
            // autoplay: {
            //     delay: 6000,
            //     disableOnInteraction: false,
            // },
            speed: 600,
            slidesPerView: 1,
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            on: {
                // Restore thumbnails when slide changes
                slideChange: function() {
                    const activeIndex = this.activeIndex;
                    const slideElements = document.querySelectorAll('.swiper-slide');
                    
                    slideElements.forEach((slide, index) => {
                        if (index !== activeIndex) {
                            restoreThumbnail(slide);
                        }
                    });
                }
            }
        });
    
        // Store original HTML to restore later
        document.querySelectorAll('.swiper-slide .video-wrapper').forEach(wrapper => {
            originalContents.push(wrapper.innerHTML);
        });
    
        function restoreThumbnail(slide) {
            const wrapper = slide.querySelector('.video-wrapper');
            const index = Array.from(slide.parentElement.children).indexOf(slide);
            
            if (wrapper && originalContents[index]) {
                // Remove iframe if exists
                const iframe = wrapper.querySelector('iframe');
                if (iframe) {
                    iframe.remove();
                }
                
                // Restore original content
                wrapper.innerHTML = originalContents[index];
            }
        }
    
        // Use event delegation instead of inline onclick
        document.addEventListener('click', function(e) {
            const videoWrapper = e.target.closest('.video-wrapper');
            if (videoWrapper) {
                playVideoAsk(videoWrapper);
            }
        });
    
        function playVideoAsk(wrapper) {
            const slide = wrapper.closest('.swiper-slide');
            const slideIndex = Array.from(slide.parentElement.children).indexOf(slide);
            const videoUrl = slides[slideIndex]?.url;
            
            if (!videoUrl) return;
    
            swiper.autoplay.stop();
    
            // Store original content if not already stored
            if (!originalContents[slideIndex]) {
                originalContents[slideIndex] = wrapper.innerHTML;
            }
    
            // Clear wrapper and add iframe directly
            wrapper.innerHTML = '';
            
            const iframe = document.createElement("iframe");
            iframe.src = `${videoUrl}?autoplay=1`;
            iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
            iframe.setAttribute("allowfullscreen", "");
            iframe.setAttribute("frameborder", "0");
            iframe.style.width = "100%";
            iframe.style.height = "100%";
            iframe.style.border = "none";
            iframe.style.aspectRatio = "3/4"; // Maintain aspect ratio
    
            wrapper.appendChild(iframe);
    
            // setTimeout(() => {
            //     swiper.autoplay.start();
            // }, 30000);
        }
    });
    </script>
