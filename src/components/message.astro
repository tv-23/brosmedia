---

---

<link
  rel="preload"
  href="/assets/styles/message.css"
  as="style"
  onload="this.onload=null;this.rel='stylesheet'"
/>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"
></script>

<div class="chat-container hidden" id="chat-box">
  <div class="chat-header">
    <button class="close-btn" id="closeChat">
      <i class="bi bi-x"></i>
    </button>
    <p style="margin: 0;">BROSMEDIA Assistant IA</p>
  </div>

  <div class="chat-body" id="chatBody">
    <div class="message-row receiver">
      <div class="message-bubble">
        üëã Bonjour et bienvenue chez Brosmedia ! Je suis votre assistant IA ü§ñ
        sp√©cialis√© en marketing digital. Comment puis-je vous aider aujourd‚Äôhui
        ?
        <div class="quick-replies">
          <div class="quick-reply" data-reply="Services">
            D√©couvrir nos services
          </div>
          <div class="quick-reply" data-reply="Tarifs">
            Consulter nos tarifs
          </div>
          <div class="quick-reply" data-reply="Portfolio">
            Voir notre portfolio
          </div>
          <div class="quick-reply" data-reply="Contact">
            Parler √† un conseiller
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    (function () {
      emailjs.init("a0BnjUTyKVDvAuKZT");
    })();

    const chatBox = document.getElementById("chat-box");
    const closeChat = document.getElementById("closeChat");
    const chatBody = document.getElementById("chatBody");
    // const chatMessage = document.getElementById("chatMessage");
    const sendBtn = document.getElementById("sendBtn");
    const micIcon = document.getElementById("micIcon");
    const fileIcon = document.getElementById("fileIcon");
    const chatBtn = document.getElementById("chat-button");

    // AI Responses with more natural language
    const AI_RESPONSES = {
      greeting: [
        "Bonjour ! Je suis l'assistant IA de Brosmedia. ü§ñ Comment puis-je vous aider aujourd'hui?",
        "Salut ! üëã Ravie de vous rencontrer. Je suis l√† pour r√©pondre √† toutes vos questions sur nos services de communication et web marketing.",
      ],
      services: `Bien s√ªr üöÄ ! Chez Brosmedia, nous aidons les entreprises √† d√©velopper leur pr√©sence en ligne gr√¢ce √† :
<br>
‚Ä¢ üåê Cr√©ation de sites web modernes et rapides<br>
‚Ä¢ üìà SEO & R√©f√©rencement Google<br>
‚Ä¢ üéØ Publicit√© digitale (Facebook, Instagram, Google)<br>
‚Ä¢ üé• Contenu audiovisuel (photos & vid√©os professionnelles)<br>
üëâ Quel domaine vous int√©resse le plus ?`,
      Sites_web: `Excellent choix üåê ! Nous cr√©ons des sites web :<br>
100% responsives (adapt√©s √† mobile, tablette, PC)<br>
Rapides ‚ö° et optimis√©s pour Google<br>
Avec un design moderne et personnalis√© üé®<br>
Et une gestion facile pour vous<br>
voulez-vous que je vous explique nos formules et tarifs pour un site ?`,
      pricing: `Tr√®s bien üëç Voici un aper√ßu :<br>

‚Ä¢ Pack Starter : site vitrine simple, √† partir de 5 000 MAD<br>
‚Ä¢ Pack Business : site complet avec optimisation SEO, √† partir de 9 000 MAD<br>
‚Ä¢ Pack Premium : site personnalis√© avec r√©servation en ligne, √† partir de 15 000 MAD<br> <br>
Tous nos sites incluent : h√©bergement s√©curis√©, certificat SSL, et support technique 12 mois.<br> <br>
üëâ Voulez-vous que je pr√©pare un devis personnalis√© pour votre entreprise ?`,

      PrepareQuote: `Parfait ! üéØ Pour pr√©parer un devis rapide, j‚Äôai besoin de quelques informations :<br>`,

      portfolio: `Nous avons eu le plaisir de travailler sur divers projets passionnants :<br>

‚Ä¢ Site e-commerce pour une marque de mode marocaine<br>
‚Ä¢ Refonte compl√®te du site vitrine d'un restaurant r√©put√© √† Larache<br>
‚Ä¢ Campagne Instagram pour un salon de beaut√© de luxe<br>
‚Ä¢ Strat√©gie SEO pour une agence immobili√®re √† Tanger<br>

Je vous invite √† d√©couvrir l'ensemble de nos r√©alisations sur https://brosmedia.ma/portfolio`,

      Publicit√©: `La publicit√© digitale, c‚Äôest le moyen le plus rapide pour g√©n√©rer des clients.
Nous g√©rons pour vous :<br><br>

‚Ä¢ Campagnes Facebook & Instagram Ads<br>
‚Ä¢ Campagnes Google Ads<br>
‚Ä¢ Ciblage pr√©cis de vos prospects<br>
‚Ä¢ Suivi et optimisation en temps r√©el<br><br>

Quel est votre objectif principal ?`,

      contact:
        "Excellent! Un de nos experts vous contactera dans les plus brefs d√©lais. üòä",
      default: [
        "Je ne suis pas s√ªr de comprendre. Pourriez-vous reformuler votre question?",
        "C'est une bonne question! Laissez-moi vous mettre en contact avec un expert humain qui pourra vous aider.",
        "Je suis encore en apprentissage. Pourriez-vous essayer de formuler votre demande autrement?",
      ],
    };

    // Services list
    const SERVICES = [
      "Cr√©ation de site web",
      "Design graphique",
      "Marketing digital",
      "Maintenance technique",
      "Formation en ligne",
      "Autres",
    ];

    if (chatBtn) {
      chatBtn.addEventListener("click", (e) => {
        e.preventDefault();

        // Desktop ‚Üí toggle chatBox
        chatBox.classList.toggle("hidden");
      });
    }

    closeChat.addEventListener("click", function () {
      chatBox.classList.add("hidden");
    });

    // Add message to chat
    function addMessage(text, sender) {
      const messageRow = document.createElement("div");
      messageRow.classList.add("message-row");
      messageRow.classList.add(sender === "user" ? "sender" : "receiver");

      const messageBubble = document.createElement("div");
      messageBubble.classList.add("message-bubble");

      // Check if the text contains HTML tags
      if (/<[a-z][\s\S]*>/i.test(text)) {
        messageBubble.innerHTML = text;
      } else {
        messageBubble.textContent = text;
      }

      messageRow.appendChild(messageBubble);
      chatBody.appendChild(messageRow);

      // Scroll to bottom
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    function showQuoteForm() {
      addMessage(
        `Parfait ! üéØ Pour pr√©parer un devis rapide, j‚Äôai besoin de quelques informations :<br>`,
        "ai",
      );

      const quoteForm = document.createElement("div");
      quoteForm.id = "QuoteForm";
      quoteForm.classList.add("contact-form");

      quoteForm.innerHTML = `
    <h3>Demande de Devis</h3>
    <div class="form-group">
      <label for="sector">Quel est votre secteur d‚Äôactivit√© ?</label>
      <input type="text" id="sector" placeholder="Ex: Restauration, Immobilier, Sant√©...">
    </div>
    <div class="form-group">
      <label>Quel est votre objectif principal ?</label>
      <div class="service-tags">
        <div class="service-tag" data-objective="plus de clients">Plus de clients</div>
        <div class="service-tag" data-objective="plus de visibilit√©">Plus de visibilit√©</div>
        <div class="service-tag" data-objective="meilleure image de marque">Meilleure image de marque</div>
      </div>
    </div>
    <div class="form-group">
      <label>Type de site pr√©f√©r√© ?</label>
      <div class="service-tags">
        <div class="service-tag" data-type="site vitrine">Site vitrine</div>
        <div class="service-tag" data-type="e-commerce">E-commerce</div>
        <div class="service-tag" data-type="r√©servation en ligne">R√©servation en ligne</div>
      </div>
    </div>
    <div class="form-group">
      <label>Options SEO :</label>
      <div class="service-tags">
        <div class="service-tag" data-seo="oui">Oui, ajoutez le SEO</div>
        <div class="service-tag" data-seo="non">Non, seulement le site</div>
      </div>
    </div>
    <div class="form-group">
      <label for="userEmail">Votre email</label>
      <input type="email" id="userEmail" placeholder="votre@email.com">
    </div>

    <div class="form-group">
      <label for="userPhone">Votre t√©l√©phone</label>
      <input type="text" id="userPhone" placeholder="+2126123456789">
    </div>
    
    <div class="form-buttons">
      <button class="cancel-btn" id="cancelQuote">Annuler</button>
      <button class="submit-btn" id="submitQuote">Envoyer</button>
    </div>
  `;

      chatBody.appendChild(quoteForm);

      // Add event listeners
      document
        .getElementById("cancelQuote")
        .addEventListener("click", function () {
          quoteForm.remove();
        });

      // Add selection functionality to all service tags
      document.querySelectorAll("#QuoteForm .service-tag").forEach((tag) => {
        tag.addEventListener("click", function () {
          // Only allow one selection per group
          const parentGroup = this.closest(".form-group");
          parentGroup
            .querySelectorAll(".service-tag")
            .forEach((t) => t.classList.remove("selected"));
          this.classList.add("selected");
        });
      });

      document
        .getElementById("submitQuote")
        .addEventListener("click", async function () {
          const sector = document.getElementById("sector").value;
          const objective =
            document.querySelector("#QuoteForm [data-objective].selected")
              ?.dataset.objective || "Non sp√©cifi√©";
          const siteType =
            document.querySelector("#QuoteForm [data-type].selected")?.dataset
              .type || "Non sp√©cifi√©";
          const seoOption =
            document.querySelector("#QuoteForm [data-seo].selected")?.dataset
              .seo || "Non sp√©cifi√©";
          const email = document.getElementById("userEmail").value;
          const phone = document.getElementById("userPhone").value;

          if (!sector || !email) {
            alert("Veuillez remplir tous les champs obligatoires.");
            return;
          }

          try {
            // Prepare email template parameters
            const templateParams = {
              message: `Bonjour, je souhaite un devis pour:
        Secteur: ${sector} \n
        Objectif: ${objective} \n
        Type de site: ${siteType} \n
        SEO: ${seoOption} \n
        Email: ${email} \n
        Telephone: ${phone}
       `,
              reply_to: email,
            };

            // Send email using EmailJS
            await emailjs.send(
              "service_8hmb2eq",
              "template_jmcu1f9",
              templateParams,
            );

            addMessage(
              `Une fois ces infos re√ßues, notre √©quipe vous enverra une proposition sous 24h üì©`,
              "ai",
            );

            // Remove form
            if (quoteForm) {
              quoteForm.remove();
            }
          } catch (error) {
            console.error("Error:", error);
            addMessage(
              "D√©sol√©, une erreur s'est produite lors de l'envoi de votre demande. Veuillez r√©essayer.",
              "ai",
            );
          }
        });

      // Scroll to bottom
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // Show typing indicator
    function showTypingIndicator() {
      const typingRow = document.createElement("div");
      typingRow.classList.add("message-row");
      typingRow.classList.add("receiver");
      typingRow.id = "typingIndicator";

      const typingBubble = document.createElement("div");
      typingBubble.classList.add("typing-indicator");

      for (let i = 0; i < 3; i++) {
        const dot = document.createElement("div");
        dot.classList.add("typing-dot");
        typingBubble.appendChild(dot);
      }

      typingRow.appendChild(typingBubble);
      chatBody.appendChild(typingRow);

      // Scroll to bottom
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // Remove typing indicator
    function removeTypingIndicator() {
      const typingIndicator = document.getElementById("typingIndicator");
      if (typingIndicator) {
        typingIndicator.remove();
      }
    }

    // AI Response logic
    function aiResponse(userMessage) {
      const lowerMessage = userMessage.toLowerCase();
      let response = "";

      if (
        lowerMessage.includes("bonjour") ||
        lowerMessage.includes("salut") ||
        lowerMessage.includes("hello") ||
        lowerMessage.includes("coucou")
      ) {
        response =
          AI_RESPONSES.greeting[
            Math.floor(Math.random() * AI_RESPONSES.greeting.length)
          ];
      } else if (
        lowerMessage.includes("prix") ||
        lowerMessage.includes("tarif") ||
        lowerMessage.includes("combien") ||
        lowerMessage.includes("co√ªt") ||
        lowerMessage.includes("budget")
      ) {
        response = AI_RESPONSES.pricing;
      } else if (
        lowerMessage.includes("portfolio") ||
        lowerMessage.includes("r√©alisation") ||
        lowerMessage.includes("projet") ||
        lowerMessage.includes("travail") ||
        lowerMessage.includes("exp√©rience")
      ) {
        response = AI_RESPONSES.portfolio;
      } else if (
        lowerMessage.includes("sites") ||
        lowerMessage.includes("web")
      ) {
        response = AI_RESPONSES.Sites_web;
      } else if (lowerMessage.includes("pr√©parez un devis")) {
        showQuoteForm();
      } else if (lowerMessage.includes("services en publicit")) {
        response = AI_RESPONSES.Publicit√©;
      } else if (
        lowerMessage.includes("service") ||
        lowerMessage.includes("offre") ||
        lowerMessage.includes("quoi") ||
        lowerMessage.includes("propos")
      ) {
        response = AI_RESPONSES.services;
      } else if (
        ("",
        "",
        "",
        lowerMessage.includes("Attirer plus de clients rapidement") ||
          lowerMessage.includes("Booster mes ventes en ligne") ||
          lowerMessage.includes("Augmenter ma notori√©t√©"))
      ) {
        response = AI_RESPONSES.services;
      } else if (
        lowerMessage.includes("contact") ||
        lowerMessage.includes("email") ||
        lowerMessage.includes("t√©l√©phone") ||
        lowerMessage.includes("adresse") ||
        lowerMessage.includes("appeler") ||
        lowerMessage.includes("humain") ||
        lowerMessage.includes("expert")
      ) {
        showContactForm();
      } else {
        response =
          AI_RESPONSES.default[
            Math.floor(Math.random() * AI_RESPONSES.default.length)
          ];
      }

      addMessage(response, "ai");

      // Add quick replies after AI response
      if (
        !lowerMessage.includes("contact") &&
        !lowerMessage.includes("humain") &&
        !lowerMessage.includes("expert")
      ) {
        setTimeout(addQuickReplies(userMessage), 300);
      }
    }

    // Show contact form
    function showContactForm() {
      const contactForm = document.createElement("div");
      contactForm.classList.add("contact-form");

      addMessage(
        "Parfait! Je vais vous mettre en contact avec un expert Brosmedia. Pourriez-vous me fournir quelques d√©tails?",
        "ai",
      );

      contactForm.innerHTML = `
                    <h3>Contactez un expert</h3>
                    <div class="form-group">
                        <label for="userQuestion">Votre question</label>
                        <textarea id="userQuestion" placeholder D√©crivez votre projet ou posez votre question..." rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Service concern√©</label>
                        <div class="service-tags">
                            ${SERVICES.map(
                              (service) =>
                                `<div class="service-tag" data-service="${service}">${service}</div>`,
                            ).join("")}
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Votre email</label>
                        <input type="email" id="userEmail" placeholder="votre@email.com">
                    </div>
                    <div class="form-buttons">
                        <button class="cancel-btn" id="cancelContact">Annuler</button>
                        <button class="submit-btn" id="submitContact">Envoyer</button>
                    </div>
                `;

      chatBody.appendChild(contactForm);

      // Add event listeners
      document
        .getElementById("cancelContact")
        .addEventListener("click", function () {
          contactForm.remove();
        });

      document.querySelectorAll(".service-tag").forEach((tag) => {
        tag.addEventListener("click", function () {
          document
            .querySelectorAll(".service-tag")
            .forEach((t) => t.classList.remove("selected"));
          this.classList.add("selected");
        });
      });

      document
        .getElementById("submitContact")
        .addEventListener("click", async function () {
          const question = document.getElementById("userQuestion").value;
          const service =
            document.querySelector(".service-tag.selected")?.dataset.service ||
            "Non sp√©cifi√©";
          const email = document.getElementById("userEmail").value;

          if (!question || !email) {
            alert("Veuillez remplir tous les champs obligatoires.");
            return;
          }

          try {
            // Prepare email template parameters
            const templateParams = {
              to_name: "Recipient Name",
              from_name: "Your Name",
              message: "question: " + question + "\n Service: " + service,
              reply_to: email,
            };

            // Send email using EmailJS instead of localhost
            await emailjs.send(
              "service_8hmb2eq",
              "template_jmcu1f9",
              templateParams,
            );

            // Show confirmation with WhatsApp link
            const whatsappMessage = encodeURIComponent(
              `Bonjour, j'ai une question concernant ${service} : ${question} (Email: ${email})`,
            );
            const whatsappUrl = `https://wa.me/212671884968?text=${whatsappMessage}`;

            addMessage(
              `Merci! Votre demande a √©t√© envoy√©e. Un expert Brosmedia vous contactera tr√®s bient√¥t.<br><br>
            <strong>Contactez-nous directement sur WhatsApp :</strong><br>
            <a href="${whatsappUrl}" target="_blank" style="color: #0a0f4f; text-decoration: underline;">
                üëâ Cliquez ici pour discuter maintenant sur WhatsApp
            </a>`,
              "ai",
            );

            // Remove form
            if (contactForm) {
              contactForm.remove();
            }
          } catch (error) {
            console.error("Error:", error);
            addMessage(
              "D√©sol√©, une erreur s'est produite lors de l'envoi de votre message. Veuillez r√©essayer.",
              "ai",
            );
          }
        });

      // Scroll to bottom
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // Quick replies
    const quickReplies = {
      default: [
        "D√©couvrir nos services",
        "Consulter nos tarifs",
        "Voir notre portfolio",
        "Parler √† un conseiller",
      ],
      Services: ["Sites web", "SEO", "Publicit√©", "Vid√©o & Photo"],
      Sites_web: ["Oui, je veux conna√Ætre les tarifs"],
      pricing: [
        "Oui, pr√©parez un devis",
        "Non, je veux d‚Äôabord voir vos services en publicit√©",
      ],
      Publicit√©: [
        "Attirer plus de clients rapidement",
        "Booster mes ventes en ligne",
        "Augmenter ma notori√©t√©",
      ],
    };

    // Add quick replies
    function addQuickReplies(userMessage) {
      console.log(userMessage);
      let quickR = [];
      switch (userMessage) {
        case "Services":
          quickR = quickReplies.Services;
          break;

        case "Non, je veux d‚Äôabord voir vos services en publicit√©":
          quickR = quickReplies.Publicit√©;
          break;

        case "Sites web":
          quickR = quickReplies.Sites_web;
          break;

        case "Oui, je veux conna√Ætre les tarifs":
          quickR = quickReplies.pricing;
          break;

        default:
          quickR = quickReplies.default;
          break;
      }

      const quickReplyContainer = document.createElement("div");
      quickReplyContainer.classList.add("quick-replies");

      quickR.forEach((reply) => {
        const quickReply = document.createElement("div");
        quickReply.classList.add("quick-reply");
        quickReply.textContent = reply;
        quickReply.addEventListener("click", function () {
          addMessage(reply, "user");
          showTypingIndicator();
          setTimeout(() => {
            removeTypingIndicator();
            aiResponse(reply);
          }, 1500);
        });

        quickReplyContainer.appendChild(quickReply);
      });

      const lastMessage = chatBody.lastElementChild;
      lastMessage.appendChild(quickReplyContainer);

      // Scroll to bottom
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // Add event listeners for quick replies in the initial message
    document.querySelectorAll(".quick-reply").forEach((reply) => {
      reply.addEventListener("click", function () {
        const replyText = this.dataset.reply;
        addMessage(replyText, "user");
        showTypingIndicator();
        setTimeout(() => {
          removeTypingIndicator();
          aiResponse(replyText);
        }, 1000);
      });
    });
  });
</script>
